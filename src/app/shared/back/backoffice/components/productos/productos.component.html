<!-- Productos - Layout reutilizable id√©ntico al dashboard -->
<app-backoffice-layout pageTitle="Productos">
  <div class="productos-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>üç´ Productos</h1>
      <p>Gestiona todos los productos de Logolate</p>
    </div>
    <div class="header-actions">
      <button class="btn-clear" (click)="clearFilters()" title="Limpiar filtros">
        üóëÔ∏è Limpiar filtros
      </button>
      <button class="btn btn-primary" (click)="createProduct()" title="Crear nuevo producto">
        ‚ûï Nuevo Producto
      </button>
      <span class="results-count">{{ filteredProductos.length }} resultados</span>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Referencia</label>
        <input 
          type="text" 
          [(ngModel)]="filtroReferencia" 
          (input)="applyFilters()"
          placeholder="Buscar por referencia..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Categor√≠a</label>
        <input 
          type="text" 
          [(ngModel)]="filtroCategoria" 
          (input)="applyFilters()"
          placeholder="Buscar por categor√≠a..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Cantidad M√≠nima</label>
        <input 
          type="text" 
          [(ngModel)]="filtroCantidadMinima" 
          (input)="applyFilters()"
          placeholder="Buscar por cantidad..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Publicado</label>
        <select 
          [(ngModel)]="filtroPublicado" 
          (change)="applyFilters()"
          class="filter-input">
          <option value="">Todos</option>
          <option value="si">S√≠</option>
          <option value="no">No</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Orden</label>
        <input 
          type="text" 
          [(ngModel)]="filtroOrden" 
          (input)="applyFilters()"
          placeholder="Buscar por orden..."
          class="filter-input">
      </div>
    </div>
  </div>

  <!-- Informaci√≥n sobre botones de flecha -->
  <div class="reorder-info-banner" *ngIf="!showReorderFeedback">
    <div class="info-content">
      <span class="info-icon">‚¨ÜÔ∏è‚¨áÔ∏è</span>
      <span class="info-text">Usa los botones ‚Üë ‚Üì en la columna "Orden" para reordenar productos dentro de la misma categor√≠a</span>
    </div>
  </div>

  <!-- Informaci√≥n durante el reordenamiento -->
  <div class="reorder-active-banner" *ngIf="showReorderFeedback && reorderingProduct">
    <div class="reorder-active-content">
      <span class="reorder-icon">‚ú®</span>
      <span class="reorder-text">
        Reordenando "{{ reorderingProduct.nombre }}" en {{ reorderingProduct.categoria | titlecase }}
        - Nueva posici√≥n: {{ reorderingProduct.orden }}
      </span>
    </div>
  </div>

  <!-- Tabla de productos -->
  <div class="table-container">
    <div class="table-wrapper">
      <table class="productos-table">
        <thead>
          <tr>
            <th class="sortable-header" (click)="sort('numeroProducto')">
              N¬∫ Producto <span class="sort-icon">{{ getSortIcon('numeroProducto') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('referencia')">
              Referencia <span class="sort-icon">{{ getSortIcon('referencia') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('categoria')">
              Categor√≠a <span class="sort-icon">{{ getSortIcon('categoria') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('cantidadMinima')">
              Cantidad M√≠nima <span class="sort-icon">{{ getSortIcon('cantidadMinima') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('precio')">
              Precio Unitario <span class="sort-icon">{{ getSortIcon('precio') }}</span>
            </th>
            <th>Foto</th>
            <th class="sortable-header" (click)="sort('fechaCreacion')">
              Fecha Creaci√≥n <span class="sort-icon">{{ getSortIcon('fechaCreacion') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('publicado')">
              Publicado <span class="sort-icon">{{ getSortIcon('publicado') }}</span>
            </th>
            <th class="sortable-header" (click)="sort('orden')">
              Orden <span class="sort-icon">{{ getSortIcon('orden') }}</span>
            </th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of filteredProductos; let i = index; trackBy: trackByFn" 
              [attr.data-category]="producto.categoria">
            <td class="id-cell">
              <span class="id-badge">#{{ producto.numeroProducto || 'N/A' }}</span>
            </td>
            <td class="referencia-cell">
              <div class="referencia-info">
                <span class="referencia-code">{{ producto.referencia }}</span>
                <span class="producto-name">{{ producto.nombre }}</span>
              </div>
            </td>
            <td class="categoria-cell">
              <span class="categoria-badge" [ngClass]="getCategoriaClass(producto.categoria)">
                {{ producto.categoria | titlecase }}
              </span>
            </td>
            <td class="cantidad-cell">
              <div class="cantidad-info">
                <span class="cantidad-number">{{ producto.cantidadMinima }}</span>
                <span class="cantidad-label">unidades</span>
              </div>
            </td>
            <td class="precio-cell">
              <div class="precio-info">
                <span class="precio-amount" *ngIf="producto.precio !== null && producto.precio !== undefined && producto.precio > 0; else noPrecio">
                  {{ producto.precio | currency:'EUR':'symbol':'1.2-2' }}
                </span>
                <ng-template #noPrecio>
                  <span class="precio-no-definido">No definido</span>
                </ng-template>
              </div>
            </td>
            <td class="foto-cell">
              <div class="producto-imagen">
                <img 
                  *ngIf="hasProductImage(producto); else noImagePlaceholder"
                  [src]="getProductImageUrl(producto)" 
                  [alt]="producto.nombre" 
                  class="producto-img"
                  (error)="onImageError($event)">
                <ng-template #noImagePlaceholder>
                  <div class="no-image-placeholder">
                    <span class="no-image-icon">üì∑</span>
                    <span class="no-image-text">Sin imagen</span>
                  </div>
                </ng-template>
              </div>
            </td>
            <td class="fecha-cell">
              {{ producto.fechaCreacion | date:'dd/MM/yyyy' }}
            </td>
            <td class="publicado-cell">
              <span class="publicado-badge" [ngClass]="getPublicadoClass(producto.publicado)">
                {{ producto.publicado ? 'S√≠' : 'No' }}
              </span>
            </td>
            <td class="orden-cell" [ngClass]="{ 'reordering': isBeingReordered(producto) }">
              <div class="orden-container">
                <div class="arrow-buttons">
                  <button 
                    *ngIf="canMoveUp(producto)"
                    class="arrow-btn arrow-up"
                    [ngClass]="getArrowColorClass(producto.categoria)"
                    (click)="moveUp(producto)"
                    title="Subir posici√≥n">
                    ‚Üë
                  </button>
                  <button 
                    *ngIf="canMoveDown(producto)"
                    class="arrow-btn arrow-down"
                    [ngClass]="getArrowColorClass(producto.categoria)"
                    (click)="moveDown(producto)"
                    title="Bajar posici√≥n">
                    ‚Üì
                  </button>
                </div>
                <span class="orden-number" [ngClass]="{ 'updating': isBeingReordered(producto) }">
                  {{ producto.ordenCategoria || producto.orden || 'N/A' }}
                </span>
              </div>
            </td>
            <td class="acciones-cell">
              <div class="acciones-group">
                <button 
                  class="btn-action btn-view" 
                  (click)="editProduct(producto)"
                  title="Ver producto">
                  üëÅÔ∏è
                </button>
                <button 
                  class="btn-action btn-edit" 
                  (click)="editProduct(producto)"
                  title="Editar producto">
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn-action btn-duplicate" 
                  (click)="duplicateProduct(producto)"
                  title="Duplicar producto">
                  üìã
                </button>
                <button 
                  class="btn-action btn-delete" 
                  (click)="deleteProduct(producto)"
                  title="Eliminar producto">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Mensaje cuando no hay resultados -->
    <div *ngIf="filteredProductos.length === 0" class="no-results">
      <div class="no-results-content">
        <span class="no-results-icon">üîç</span>
        <h3>No se encontraron productos</h3>
        <p>Intenta ajustar los filtros de b√∫squeda</p>
      </div>
    </div>
  </div>
  </div>
</app-backoffice-layout>
