<app-backoffice-layout pageTitle="Opciones Generales">
  <!-- Contenido de configuraci√≥n -->
    <div class="configuracion-content">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando configuraci√≥n...</p>
      </div>

      <!-- Configuraci√≥n Principal -->
      <div *ngIf="!isLoading" class="config-container">
        <!-- Pesta√±as -->
        <div class="tabs-container">
          <div class="tabs-header">
            <button 
              *ngFor="let tab of tabs" 
              class="tab-button"
              [class.active]="activeTab === tab.id"
              (click)="setActiveTab(tab.id)">
              <span class="tab-icon">{{ tab.icon }}</span>
              <span class="tab-label">{{ tab.label }}</span>
            </button>
          </div>

          <!-- Contenido de las pesta√±as -->
          <div class="tab-content">
            <!-- Pesta√±a SEO -->
            <div *ngIf="activeTab === 'seo'" class="tab-panel">
              <div class="panel-header">
                <h2>üîç Configuraci√≥n SEO</h2>
                <p>Optimiza tu sitio web para motores de b√∫squeda</p>
              </div>

              <form [formGroup]="seoForm" class="config-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="homeTitle">T√≠tulo de la p√°gina principal *</label>
                    <input 
                      type="text" 
                      id="homeTitle"
                      formControlName="homeTitle"
                      class="form-control"
                      maxlength="60"
                      placeholder="Ej: Logolate - Dulces Artesanales Premium">
                    <small class="form-hint">M√°ximo 60 caracteres. Aparece en la pesta√±a del navegador y en Google.</small>
                    <div *ngIf="seoForm.get('homeTitle')?.invalid && seoForm.get('homeTitle')?.touched" class="error-message">
                      El t√≠tulo es requerido y debe tener m√°ximo 60 caracteres.
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="homeDescription">Meta descripci√≥n *</label>
                    <textarea 
                      id="homeDescription"
                      formControlName="homeDescription"
                      class="form-control"
                      rows="3"
                      maxlength="160"
                      placeholder="Describe brevemente tu sitio web..."></textarea>
                    <small class="form-hint">M√°ximo 160 caracteres. Aparece en los resultados de Google.</small>
                    <div *ngIf="seoForm.get('homeDescription')?.invalid && seoForm.get('homeDescription')?.touched" class="error-message">
                      La descripci√≥n es requerida y debe tener m√°ximo 160 caracteres.
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="homeKeywords">Palabras clave *</label>
                    <input 
                      type="text" 
                      id="homeKeywords"
                      formControlName="homeKeywords"
                      class="form-control"
                      placeholder="chocolates, caramelos, dulces artesanales">
                    <small class="form-hint">Separa las palabras clave con comas.</small>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group col-half">
                    <label for="siteName">Nombre del sitio *</label>
                    <input 
                      type="text" 
                      id="siteName"
                      formControlName="siteName"
                      class="form-control"
                      placeholder="Logolate">
                  </div>
                  <div class="form-group col-half">
                    <label for="defaultImage">Imagen por defecto</label>
                    <div class="image-upload-container">
                      <div class="image-preview" (click)="openImageSelector('seo', 'defaultImage')">
                        <img 
                          [src]="getImagePreview('seo', 'defaultImage')" 
                          alt="Imagen por defecto Preview"
                          class="preview-image"
                          (error)="onImageError($event)">
                        <div class="upload-overlay">
                          <i class="fas fa-camera"></i>
                          <span>Cambiar imagen</span>
                        </div>
                      </div>
                      <input 
                        type="text" 
                        id="defaultImage"
                        formControlName="defaultImage"
                        class="form-control image-url-input"
                        placeholder="/assets/images/logo-social.jpg"
                        readonly>
                    </div>
                    <small class="form-hint">Haz clic en la imagen para cambiarla. URL de la imagen para redes sociales.</small>
                  </div>
                </div>
              </form>
            </div>

            <!-- Pesta√±a Footer -->
            <div *ngIf="activeTab === 'footer'" class="tab-panel">
              <div class="panel-header">
                <h2>üìÑ Configuraci√≥n del Footer</h2>
                <p>Gestiona la informaci√≥n de contacto y contenido del pie de p√°gina</p>
              </div>

              <form [formGroup]="footerForm" class="config-form">
                <div class="form-section">
                  <h3>Informaci√≥n de Contacto</h3>
                  
                  <div class="form-row">
                    <div class="form-group col-half">
                      <label for="contactoTelefono">Tel√©fono *</label>
                      <input 
                        type="tel" 
                        id="contactoTelefono"
                        formControlName="contactoTelefono"
                        class="form-control"
                        placeholder="+34 123 456 789">
                    </div>
                    <div class="form-group col-half">
                      <label for="contactoEmail">Email *</label>
                      <input 
                        type="email" 
                        id="contactoEmail"
                        formControlName="contactoEmail"
                        class="form-control"
                        placeholder="info@logolate.com">
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="contactoDireccion">Direcci√≥n *</label>
                      <input 
                        type="text" 
                        id="contactoDireccion"
                        formControlName="contactoDireccion"
                        class="form-control"
                        placeholder="Calle Dulce, 123, 28001 Madrid">
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="horarioAtencion">Horario de atenci√≥n *</label>
                      <input 
                        type="text" 
                        id="horarioAtencion"
                        formControlName="horarioAtencion"
                        class="form-control"
                        placeholder="Lunes a Viernes: 9:00 - 18:00">
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <h3>Contenido</h3>
                  
                  <div class="form-row">
                    <div class="form-group">
                      <label for="queEsLogolate">"¬øQu√© es Logolate?" *</label>
                      <textarea 
                        id="queEsLogolate"
                        formControlName="queEsLogolate"
                        class="form-control"
                        rows="4"
                        maxlength="500"
                        placeholder="Describe qu√© es Logolate..."></textarea>
                      <small class="form-hint">M√°ximo 500 caracteres.</small>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <h3>Redes Sociales</h3>
                  
                  <div class="form-row">
                    <div class="form-group">
                      <label for="instagram">Instagram</label>
                      <input 
                        type="url" 
                        id="instagram"
                        formControlName="instagram"
                        class="form-control"
                        placeholder="https://instagram.com/logolate">
                    </div>
                  </div>
                </div>
              </form>
            </div>

            <!-- Pesta√±a General -->
            <div *ngIf="activeTab === 'general'" class="tab-panel">
              <div class="panel-header">
                <h2>‚öôÔ∏è Configuraci√≥n General</h2>
                <p>Logos, colores y configuraciones b√°sicas del sitio</p>
              </div>

              <form [formGroup]="generalForm" class="config-form">
                <div class="form-section">
                  <h3>Logos e Im√°genes</h3>
                  
                  <div class="form-row">
                    <div class="form-group">
                      <label for="logoHeader">Logo del header</label>
                      <div class="image-upload-container">
                        <div class="image-preview" (click)="openImageSelector('general', 'logoHeader')">
                          <img 
                            [src]="getImagePreview('general', 'logoHeader')" 
                            alt="Logo Header Preview"
                            class="preview-image"
                            (error)="onImageError($event)">
                          <div class="upload-overlay">
                            <i class="fas fa-camera"></i>
                            <span>Cambiar imagen</span>
                          </div>
                        </div>
                        <input 
                          type="text" 
                          id="logoHeader"
                          formControlName="logoHeader"
                          class="form-control image-url-input"
                          placeholder="/assets/images/logo-header.png"
                          readonly>
                      </div>
                      <small class="form-hint">Haz clic en la imagen para cambiarla. Recomendado: 200x60px, formato PNG con fondo transparente.</small>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="logoFooter">Logo del footer</label>
                      <div class="image-upload-container">
                        <div class="image-preview" (click)="openImageSelector('general', 'logoFooter')">
                          <img 
                            [src]="getImagePreview('general', 'logoFooter')" 
                            alt="Logo Footer Preview"
                            class="preview-image"
                            (error)="onImageError($event)">
                          <div class="upload-overlay">
                            <i class="fas fa-camera"></i>
                            <span>Cambiar imagen</span>
                          </div>
                        </div>
                        <input 
                          type="text" 
                          id="logoFooter"
                          formControlName="logoFooter"
                          class="form-control image-url-input"
                          placeholder="/assets/images/logo-footer.png"
                          readonly>
                      </div>
                      <small class="form-hint">Haz clic en la imagen para cambiarla. Recomendado: 150x45px, formato PNG.</small>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="favicon">Favicon</label>
                      <div class="image-upload-container">
                        <div class="image-preview favicon-preview" (click)="openImageSelector('general', 'favicon')">
                          <img 
                            [src]="getImagePreview('general', 'favicon')" 
                            alt="Favicon Preview"
                            class="preview-image favicon-image"
                            (error)="onImageError($event)">
                          <div class="upload-overlay">
                            <i class="fas fa-camera"></i>
                            <span>Cambiar favicon</span>
                          </div>
                        </div>
                        <input 
                          type="text" 
                          id="favicon"
                          formControlName="favicon"
                          class="form-control image-url-input"
                          placeholder="/assets/images/favicon.ico"
                          readonly>
                      </div>
                      <small class="form-hint">Haz clic en la imagen para cambiarla. Recomendado: 32x32px, formato ICO o PNG.</small>
                    </div>
                  </div>
                </div>


              </form>
            </div>

            <!-- Pesta√±a Banner -->
            <div *ngIf="activeTab === 'banner'" class="tab-panel">
              <div class="panel-header">
                <h2>üé® Configuraci√≥n de Banners</h2>
                <p>Gestiona los banners del hero principal</p>
                <button class="btn btn-primary" (click)="addBanner()">
                  <span>‚ûï</span> Agregar Banner
                </button>
              </div>

              <div class="banners-list">
                <div *ngFor="let banner of configuracionData.banner.banners; let i = index" class="banner-item">
                  <div class="banner-header">
                    <h4>Banner {{ i + 1 }}</h4>
                    <div class="banner-actions">
                      <label class="toggle-switch">
                        <input type="checkbox" [(ngModel)]="banner.activo">
                        <span class="slider"></span>
                      </label>
                      <button class="btn btn-danger btn-sm" (click)="removeBanner(banner.id)">
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>

                  <div class="banner-form">
                    <div class="form-row">
                      <div class="form-group col-half">
                        <label>T√≠tulo</label>
                        <input 
                          type="text" 
                          [(ngModel)]="banner.titulo"
                          class="form-control"
                          placeholder="T√≠tulo del banner">
                      </div>
                      <div class="form-group col-half">
                        <label>Subt√≠tulo</label>
                        <input 
                          type="text" 
                          [(ngModel)]="banner.subtitulo"
                          class="form-control"
                          placeholder="Subt√≠tulo del banner">
                      </div>
                    </div>

                    <div class="form-row">
                      <div class="form-group col-half">
                        <label>Imagen Desktop</label>
                        <div class="image-upload-container">
                          <div class="image-preview banner-preview" (click)="openImageSelector('banner', 'imagen', i)">
                            <img 
                              [src]="getBannerImagePreview(banner.imagen)" 
                              alt="Banner Desktop Preview"
                              class="preview-image banner-image"
                              (error)="onImageError($event)">
                            <div class="upload-overlay">
                              <i class="fas fa-camera"></i>
                              <span>Cambiar imagen</span>
                            </div>
                          </div>
                          <input 
                            type="text" 
                            [(ngModel)]="banner.imagen"
                            class="form-control image-url-input"
                            placeholder="/assets/images/banner.jpg"
                            readonly>
                        </div>
                        <small class="form-hint">Haz clic en la imagen para cambiarla. Recomendado: 1920x600px.</small>
                      </div>
                      <div class="form-group col-half">
                        <label>Imagen Mobile</label>
                        <div class="image-upload-container">
                          <div class="image-preview banner-preview" (click)="openImageSelector('banner', 'imagenMobile', i)">
                            <img 
                              [src]="getBannerImagePreview(banner.imagenMobile)" 
                              alt="Banner Mobile Preview"
                              class="preview-image banner-image"
                              (error)="onImageError($event)">
                            <div class="upload-overlay">
                              <i class="fas fa-mobile-alt"></i>
                              <span>Cambiar imagen</span>
                            </div>
                          </div>
                          <input 
                            type="text" 
                            [(ngModel)]="banner.imagenMobile"
                            class="form-control image-url-input"
                            placeholder="/assets/images/banner-mobile.jpg"
                            readonly>
                        </div>
                        <small class="form-hint">Imagen optimizada para m√≥viles. Recomendado: 768x400px.</small>
                      </div>
                    </div>

                    <div class="form-row">
                      <div class="form-group col-half">
                        <label>Enlace</label>
                        <input 
                          type="text" 
                          [(ngModel)]="banner.enlace"
                          class="form-control"
                          placeholder="/productos">
                      </div>
                      <div class="form-group col-half">
                        <label>Orden</label>
                        <input 
                          type="number" 
                          [(ngModel)]="banner.orden"
                          class="form-control"
                          min="1">
                      </div>
                    </div>

                    <div class="form-row">
                      <div class="form-group">
                        <label>Nombre del bot√≥n</label>
                        <input 
                          type="text" 
                          [(ngModel)]="banner.nombreBoton"
                          class="form-control"
                          placeholder="Ver M√°s">
                        <small class="form-hint">Texto que aparecer√° en el bot√≥n del banner.</small>
                      </div>
                    </div>

                    <div class="form-row">
                      <div class="form-group col-half">
                        <label>Color del bot√≥n</label>
                        <div class="color-input-group">
                          <input 
                            type="color" 
                            [(ngModel)]="banner.colorBoton"
                            class="color-picker">
                          <input 
                            type="text" 
                            [(ngModel)]="banner.colorBoton"
                            class="form-control color-text"
                            placeholder="#3B82F6">
                        </div>
                        <small class="form-hint">Color de fondo del bot√≥n.</small>
                      </div>
                      <div class="form-group col-half">
                        <label>Color de los t√≠tulos</label>
                        <div class="color-input-group">
                          <input 
                            type="color" 
                            [(ngModel)]="banner.colorTitulos"
                            class="color-picker">
                          <input 
                            type="text" 
                            [(ngModel)]="banner.colorTitulos"
                            class="form-control color-text"
                            placeholder="#FFFFFF">
                        </div>
                        <small class="form-hint">Color del t√≠tulo y subt√≠tulo.</small>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="configuracionData.banner.banners.length === 0" class="empty-banners">
                  <p>No hay banners configurados. Haz clic en "Agregar Banner" para crear uno.</p>
                </div>
              </div>
            </div>

            <!-- Pesta√±a Im√°genes -->
            <div *ngIf="activeTab === 'imagenes'" class="tab-panel">
              <div class="panel-header">
                <h2>üñºÔ∏è Subir Im√°genes</h2>
                <p>Sube im√°genes a la carpeta /assets/images/ de tu sitio web</p>
              </div>

              <div class="simple-upload-section">
                <div class="upload-area">
                  <input 
                    type="file" 
                    id="imageUpload" 
                    accept="image/*" 
                    multiple
                    (change)="uploadSimpleImage($event)"
                    style="display: none;">
                  
                  <div class="upload-box" onclick="document.getElementById('imageUpload').click()">
                    <div class="upload-icon">üì§</div>
                    <h3>Subir Im√°genes</h3>
                    <p>Haz clic aqu√≠ o arrastra las im√°genes</p>
                    <button type="button" class="btn btn-primary btn-lg">
                      Seleccionar Im√°genes
                    </button>
                  </div>
                  
                  <div class="upload-info">
                    <small class="text-muted">
                      ‚Ä¢ Formatos permitidos: JPEG, PNG, GIF, WebP<br>
                      ‚Ä¢ Tama√±o m√°ximo por imagen: 5MB<br>
                      ‚Ä¢ Las im√°genes se guardar√°n en /assets/images/
                    </small>
                  </div>
                </div>

                <!-- Lista de im√°genes subidas recientemente -->
                <div class="recent-uploads" *ngIf="recentUploads.length > 0">
                  <h4>Im√°genes subidas recientemente:</h4>
                  <div class="recent-list">
                    <div *ngFor="let upload of recentUploads" class="recent-item">
                      <span class="file-icon">üñºÔ∏è</span>
                      <span class="file-name">{{ upload.name }}</span>
                      <span class="file-status success">‚úÖ Subida exitosa</span>
                      <small class="file-path">/assets/images/{{ upload.name }}</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="form-actions">
            <button 
              class="btn btn-primary btn-lg"
              (click)="saveCurrentTab()"
              [disabled]="isSaving">
              <span *ngIf="!isSaving">üíæ Guardar Cambios</span>
              <span *ngIf="isSaving">‚è≥ Guardando...</span>
            </button>
          </div>
        </div>
      </div>
    </div>
</app-backoffice-layout>
