<!-- Layout reutilizable del backoffice -->
<app-backoffice-layout 
  pageTitle="Presupuestos"
  [breadcrumbs]="[
    {label: 'Presupuestos'}
  ]">
  
  <!-- Contenido de presupuestos -->
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>🍫 Presupuestos</h1>
      <p>Gestiona todos los presupuestos de Logolate</p>
    </div>
    <div class="header-actions">
      <button class="btn-clear" (click)="clearFilters()" title="Limpiar filtros">
        🗑️ Limpiar filtros
      </button>
      <span class="results-count">{{ filteredPresupuestos.length }} resultados</span>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Empresa</label>
        <input 
          type="text" 
          [(ngModel)]="filtroEmpresa" 
          (input)="applyFilters()"
          placeholder="Buscar por empresa..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Cantidad</label>
        <input 
          type="text" 
          [(ngModel)]="filtroCantidad" 
          (input)="applyFilters()"
          placeholder="Buscar por cantidad..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Teléfono</label>
        <input 
          type="text" 
          [(ngModel)]="filtroTelefono" 
          (input)="applyFilters()"
          placeholder="Buscar por teléfono..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Email</label>
        <input 
          type="text" 
          [(ngModel)]="filtroEmail" 
          (input)="applyFilters()"
          placeholder="Buscar por email..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Estado</label>
        <select 
          [(ngModel)]="filtroEstado" 
          (change)="applyFilters()"
          class="filter-input">
          <option value="">Todos los estados</option>
          <option value="pendiente">Pendiente</option>
          <option value="aprobado">Aprobado</option>
          <option value="rechazado">Rechazado</option>
          <option value="enviado">Enviado</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Tabla de presupuestos -->
  <div class="table-container">
    <div class="table-wrapper">
      <table class="presupuestos-table">
        <thead>
          <tr>
            <th class="sortable-header" (click)="sortBy('numeroPresupuesto')">
              Nº Presupuesto <span class="sort-icon">{{ getSortIcon('numeroPresupuesto') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('nombreEmpresa')">
              Empresa <span class="sort-icon">{{ getSortIcon('nombreEmpresa') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('cantidadTotal')">
              Cantidad Total <span class="sort-icon">{{ getSortIcon('cantidadTotal') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('telefono')">
              Teléfono <span class="sort-icon">{{ getSortIcon('telefono') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('email')">
              Email <span class="sort-icon">{{ getSortIcon('email') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('fecha')">
              Fecha <span class="sort-icon">{{ getSortIcon('fecha') }}</span>
            </th>
            <th class="sortable-header" (click)="sortBy('estado')">
              Estado <span class="sort-icon">{{ getSortIcon('estado') }}</span>
            </th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let presupuesto of filteredPresupuestos; trackBy: trackByFn" 
              class="table-row">
            <td class="id-cell">
              <span class="id-badge">#{{ presupuesto.numeroPresupuesto }}</span>
            </td>
            <td class="empresa-cell">
              <div class="empresa-info">
                <span class="empresa-name">{{ presupuesto.nombreEmpresa }}</span>
              </div>
            </td>
            <td class="cantidad-cell">
              <div class="cantidad-info">
                <span class="cantidad-number">{{ presupuesto.cantidadTotal }}</span>
                <span class="cantidad-label">productos</span>
              </div>
            </td>
            <td class="telefono-cell">
              <a href="tel:{{ presupuesto.telefono }}" class="telefono-link">
                📞 {{ presupuesto.telefono }}
              </a>
            </td>
            <td class="email-cell">
              <a href="mailto:{{ presupuesto.email }}" class="email-link">
                ✉️ {{ presupuesto.email }}
              </a>
            </td>
            <td class="fecha-cell">
              {{ presupuesto.fecha | date:'dd/MM/yyyy' }}
            </td>
            <td class="estado-cell">
              <span class="estado-badge" [ngClass]="getEstadoClass(presupuesto.estado)">
                {{ getEstadoLabel(presupuesto.estado) }}
              </span>
            </td>
            <td class="acciones-cell">
              <div class="acciones-group">
                <button 
                  class="btn-action btn-view" 
                  (click)="viewPresupuesto(presupuesto.numeroPresupuesto.toString())"
                  title="Ver presupuesto">
                  👁️
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Mensaje cuando no hay resultados -->
    <div *ngIf="filteredPresupuestos.length === 0" class="no-results">
      <div class="no-results-content">
        <span class="no-results-icon">🔍</span>
        <h3>No se encontraron presupuestos</h3>
        <p>Intenta ajustar los filtros de búsqueda</p>
      </div>
    </div>
  </div>

</app-backoffice-layout>
